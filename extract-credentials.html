<!DOCTYPE html>
<html>
<head>
    <title>Extract SPTrader Credentials</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: #fff;
            padding: 20px;
            margin: 0;
        }
        h1 {
            color: #4fc3f7;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        pre {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .error {
            color: #ff6b6b;
            background-color: #3a2020;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            color: #51cf66;
            background-color: #203a20;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .info {
            color: #74c0fc;
            background-color: #1c2a3a;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        button {
            background-color: #4fc3f7;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            background-color: #29b6f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SPTrader Credentials Extractor</h1>
        
        <div class="info">
            <p><strong>Instructions:</strong></p>
            <ol>
                <li>Open SPTrader app and make sure you're logged in with your broker profiles</li>
                <li>Open Developer Tools in the SPTrader app (Cmd+Option+I on Mac)</li>
                <li>Go to Console tab</li>
                <li>Copy and paste this entire script into the console:</li>
            </ol>
        </div>

        <button onclick="copyScript()">Copy Script to Clipboard</button>
        
        <pre id="script">// SPTrader Credential Extractor Script
// This script extracts and decrypts stored broker credentials

(function() {
    // Simple decrypt function (matches the one in useBrokerStore.ts)
    function simpleDecrypt(text) {
        try {
            return atob(text);
        } catch {
            return text;
        }
    }

    // Get the stored data
    const storedData = localStorage.getItem('brokerAccounts');
    
    if (!storedData) {
        console.error('No broker accounts found in localStorage');
        return;
    }
    
    try {
        const parsed = JSON.parse(storedData);
        const state = parsed.state || parsed;
        const profiles = state.profiles || [];
        
        console.log('=== EXTRACTED CREDENTIALS ===');
        console.log('Found ' + profiles.length + ' broker profile(s)');
        console.log('');
        
        const decryptedProfiles = profiles.map(profile => ({
            id: profile.id,
            name: profile.name,
            broker: profile.broker,
            account: profile.account,
            environment: profile.environment,
            apiKey: simpleDecrypt(profile.apiKey),
            apiSecret: profile.apiSecret ? simpleDecrypt(profile.apiSecret) : undefined,
            isActive: profile.isActive
        }));
        
        decryptedProfiles.forEach((profile, index) => {
            console.log('Profile #' + (index + 1) + ':');
            console.log('  Name: ' + profile.name);
            console.log('  Broker: ' + profile.broker);
            console.log('  Account: ' + profile.account);
            console.log('  Environment: ' + (profile.environment || 'Not specified'));
            console.log('  API Key: ' + profile.apiKey);
            if (profile.apiSecret) {
                console.log('  API Secret: ' + profile.apiSecret);
            }
            console.log('  Active: ' + (profile.isActive ? 'Yes' : 'No'));
            console.log('');
        });
        
        console.log('=== JSON FORMAT ===');
        console.log(JSON.stringify(decryptedProfiles, null, 2));
        console.log('===================');
        
        // Also copy to clipboard
        const credentialText = JSON.stringify(decryptedProfiles, null, 2);
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(credentialText).then(() => {
                console.log('âœ… Credentials copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy to clipboard:', err);
            });
        }
        
    } catch (error) {
        console.error('Error parsing broker accounts:', error);
        console.log('Raw data:', storedData);
    }
})();</pre>

        <div class="info" style="margin-top: 20px;">
            <p><strong>Alternative Method:</strong></p>
            <p>If the above doesn't work, you can also try this in the SPTrader app console:</p>
        </div>

        <pre>localStorage.getItem('brokerAccounts')</pre>

        <div id="result"></div>
    </div>

    <script>
        function copyScript() {
            const script = document.getElementById('script').textContent;
            navigator.clipboard.writeText(script).then(() => {
                document.getElementById('result').innerHTML = '<div class="success">Script copied to clipboard! Now paste it in the SPTrader console.</div>';
            }).catch(err => {
                document.getElementById('result').innerHTML = '<div class="error">Failed to copy: ' + err + '</div>';
            });
        }
    </script>
</body>
</html>