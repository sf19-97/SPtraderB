<!DOCTYPE html>
<html>
<head>
    <title>Test Stored Credentials</title>
</head>
<body>
    <h1>Test Stored OANDA Credentials</h1>
    <p>Open browser console to see results...</p>
    
    <script>
        // Read from localStorage
        const storedData = localStorage.getItem('broker-profiles');
        
        if (storedData) {
            const data = JSON.parse(storedData);
            console.log('Stored data:', data);
            
            if (data.state && data.state.profiles) {
                const oandaProfile = data.state.profiles.find(p => p.broker === 'OANDA');
                if (oandaProfile) {
                    console.log('Found OANDA profile:', oandaProfile.name);
                    
                    // Decrypt API key (simple base64 decode)
                    try {
                        const decryptedKey = atob(oandaProfile.apiKey);
                        console.log('Decrypted API Key length:', decryptedKey.length);
                        console.log('API Key preview:', decryptedKey.substring(0, 8) + '...' + decryptedKey.substring(decryptedKey.length - 4));
                        console.log('Account ID:', oandaProfile.account);
                        
                        // Test the credentials
                        const testUrl = `https://api-fxpractice.oanda.com/v3/accounts/${oandaProfile.account}`;
                        console.log('Testing URL:', testUrl);
                        
                        fetch(testUrl, {
                            headers: {
                                'Authorization': 'Bearer ' + decryptedKey,
                                'Content-Type': 'application/json'
                            }
                        })
                        .then(response => {
                            console.log('Response status:', response.status);
                            return response.text();
                        })
                        .then(text => {
                            console.log('Response:', text);
                        })
                        .catch(error => {
                            console.error('Fetch error:', error);
                        });
                        
                    } catch (e) {
                        console.error('Failed to decrypt:', e);
                    }
                }
            }
        } else {
            console.log('No broker profiles found in localStorage');
        }
    </script>
</body>
</html>